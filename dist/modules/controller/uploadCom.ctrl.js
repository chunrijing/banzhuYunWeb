"use strict";angular.module("core").controller("uploadComCtrl",["$scope","$http","$uibModalInstance","items","$timeout","commonService","$uibModal",function(e,o,t,a,n,i,r,l){function s(e){if(null!=e)switch(e.status){case"1":e.name="(新增)"+e.name;break;case"2":case"3":e.name="(更新)"+e.name}if(null!=e&&null!=e.children&&""!=e.children)for(var o=0;o<e.children.length;o++)s(e.children[o])}e.items=a,e.selected={item:e.items},e.cancel=function(){t.dismiss("cancel")};var d,c,p={check:{enable:!0,chkStyle:"checkbox",chkboxType:{Y:"ps",N:"ps"}},view:{showIcon:!1,showLine:!1},data:{simpleData:{enable:!0}}};""==(d=BzCloudComp.GetUpLoadDetail())?(document.title="提示",alert("当前无可上传构件!")):s(d=JSON.parse(d)),e.clothAlert=function(){t.dismiss("cancel")},$(document).ready(function(){$.fn.zTree.init($(".uploadCom .ztree"),p,d),(c=$.fn.zTree.getZTreeObj("treeLeft")).expandAll(!0)}),e.upload=function(){var e;e=1==$(".uploadCom .public>input").prop("checked")?0:1;for(var o=c.getChangeCheckedNodes(),t=[],a=1,n=0;n<o.length;n++){var i={identify:o[n].identify,type:o[n].type,status:o[n].status};if(t.push(i),""!=o[n].status&&void 0!=o[n].status||alert("请选择构件！"),1==o[n].status){a=1;break}a=0}if(0!=t.length)switch(a){case 0:BzCloudComp.UpLoadDetail(e,JSON.stringify(t),""),$(".uploadCom").hide(),$(".progressWrap").show();break;case 1:if(t==[])return;$(".uploadComSet").show(),$(".uploadCom").hide()}},e.comId=!0,1==BzCloudComp.GetEpType()&&(e.comId=!1);var u,h,g=[],m={view:{showIcon:!1,showLine:!1},data:{simpleData:{enable:!0,idKey:"orgId",pIdKey:"parentId"},key:{name:"orgName"}},callback:{onClick:function(e,o,t){$($(e.target)[0]).toggleClass("showNode"),$($(e.target)[0]).hasClass("showNode")?g[t.orgId.toString()]=t.orgId.toString():g[t.orgId.toString()]=null,console.log(g)}}};i.getComponent().then(function(e){h=e.data,$.fn.zTree.init($(".uploadComSet .ztree"),m,h),$("#treeRight>li:first-child>a .node_name").addClass("showNode"),(u=$.fn.zTree.getZTreeObj("treeRight")).expandAll(!0);var o=u.getNodesByFilter(function(e){return 0==e.level},!0);g[o.orgId.toString()]=o.orgId.toString(),console.log(g)}),e.ok=function(){console.log(g);var e;e=1==$(".uploadCom .public>input").prop("checked")?0:1;for(var o=c.getChangeCheckedNodes(),t=[],a=0;a<o.length;a++){var n={identify:o[a].identify,type:o[a].type,status:o[a].status};t.push(n)}var i="";for(var r in g)null!=g[r]&&(""!=i&&(i+=","),i+=g[r]);""!=i&&($(".uploadComSet").hide(),$(".progressWrap").show(),BzCloudComp.UpLoadDetail(e,JSON.stringify(t),i))},e.close=function(){510!=$(".progressWrap #prog").width()?$(".progressWrap .proModal").show():t.dismiss("cancel")},e.btnCancel=function(){$(".progressWrap .proModal").hide()},e.btnOk=function(){t.dismiss("cancel"),BzCloudComp.CancelUpLoad()},i.heartBeat()}]);