"use strict";angular.module("core").controller("uploadCtrl",["$scope","commonService","$uibModal",function(t,e,a){function o(t){angular.forEach(t,function(t,e,a){1==t.status&&(t.status="待审核"),2==t.status&&(t.status="已通过"),3==t.status&&(t.status="未通过")})}function n(a){"null"!=t.originEpId&&""!=t.originEpId||(t.originEpId=null),$(".upload .component-list h4").length>=0&&$(".upload .component-list h4").remove(),layer.load(2,{shade:!1}),e.uploadList(a).then(function(e){setTimeout(function(){layer.closeAll("loading")},10),t.uploadList=e.data.itemList,i(t.uploadList),o(t.uploadList),t.bigTotalItems=e.data.totalRowCount;0==t.uploadList.length?($(".upload .pagination").hide(),$(".upload .component-list").append("<h4 style='margin: 15% 0 0 43%;'>没有找到相关构件</h4>")):$(".upload .pagination").show()})}function i(t){t.map(function(t){0==t.attachment.length&&(t.attachment[0]={},t.attachment[0].displayUrl="imgs/placeholder.png")})}function l(){return p=$(".dump-inp input").val()}t.isAduit=!1;var r=ApplicationConfiguration.pagesize.pageSize;t.pageSize=r,window.onresize=function(){$(".tableBody").css("width",$(".container-fluid").css("width"))},layer.load(2,{shade:!1}),e.uploadList({status:null,componentDisplayName:"",originEpId:null,order:"DESC",currentPage:1,pageSize:r}).then(function(e){setTimeout(function(){layer.closeAll("loading")},10),t.uploadList=e.data.itemList,i(t.uploadList),t.bigTotalItems=e.data.totalRowCount,o(t.uploadList),t.totalItems=e.data.totalRowCount,t.status=null,t.searchText="",t.originEpId=null;0==t.uploadList.length?($(".upload .pagination").hide(),$(".upload .component-list").append("<h4 style='margin: 15% 0 0 43%;'>没有找到相关构件</h4>")):$(".upload .pagination").show()});var s={};e.getPermis().then(function(e){var a=e.data;2==BzCloudComp.GetEpType()&&""!=a&&(t.orgShow=!0),a=a.split(";");for(var o=0;o<a.length;o++)"30002003"==a[o]&&(t.isAduit=!0)}),t.search=function(e,a){if(e&&13!=e.keyCode&&10!=e.keyCode)return!1;t.searchText=a,n(s={status:t.status,componentDisplayName:a,originEpId:null,order:"DESC",currentPage:1,pageSize:r})},t.getComponent=function(e,a){t.currentPage=1,t.status=e,n(s={status:e,componentDisplayName:"",originEpId:null,order:"DESC",currentPage:1,pageSize:r})},t.getOpinion=function(e){t.opinion=""==e?"暂无":e},t.setPage=function(e){t.currentPage=e},t.pageChanged=function(e){n(s={status:t.status,componentDisplayName:t.searchText,originEpId:t.originEpId,order:"DESC",currentPage:e,pageSize:r}),t.page=e},t.maxSize=5;var p;t.getDumpOk=function(e,a){if(e&&13!=e.keyCode)return!1;var o=parseInt(l());if(o>a)return alert("查询页码超出范围，请重新输入"),$(".dump-inp input").val(""),!1;t.setPage(l()),n(s={status:t.status,componentDisplayName:t.searchText,originEpId:t.originEpId,order:"DESC",currentPage:o,pageSize:r}),t.page=o,$(".dump-inp input").val("")},$(".return-top").click(function(){$(".componet-base-main").animate({scrollTop:0},500)}),t.uploadCom=function(){if(BzCloudComp.GetVersion){if(console.log("新版本"),""==BzCloudComp.GetUpLoadDetail())return document.title="提示",void alert("当前无可上传构件!");a.open({windowClass:"uploadCom-modal",backdrop:"static",animation:!1,size:"lg",templateUrl:"template/component/uploadCom.html",controller:"uploadComCtrl",resolve:{items:function(){return t.items}}}).result.then(function(e){t.selected=e},function(){})}else alert("客户端版本过低，请升级到最新版本！")},t.order=function(e){var a=void 0;a=$(e.target).hasClass("glyphicon")?$(e.target).parent():$(e.target),$(a).toggleClass("showOrder"),n(1==$(".showOrder").length?s={status:t.status,componentDisplayName:t.searchText,originEpId:t.originEpId,order:"ASC",currentPage:t.page,pageSize:r}:s={status:t.status,componentDisplayName:t.searchText,originEpId:t.originEpId,order:"DESC",currentPage:t.page,pageSize:r})},t.componetModal=function(e){t.items=e,a.open({windowClass:"component-modal largePattern-modal",backdrop:"static",animation:!1,size:"lg",templateUrl:"template/core/largeModal.html",controller:"largeModalCtrl",resolve:{items:function(){return t.items}}}).result.then(function(e){"deleteOk"==e&&n(s={status:t.status,componentDisplayName:t.searchText,originEpId:t.originEpId,order:"DESC",currentPage:t.page,pageSize:r})},function(){})},e.heartBeat()}]);